<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Evento — BroadWatch</title>
    <link rel="stylesheet" href="/static/ui/styles.css">
  </head>
  <body>
    <header class="ui-header">
      <div class="header-left">
        <div class="logo">BroadWatch</div>
      </div>
      <div class="header-right">
        <a href="/ui" class="btn btn-ghost">Volver</a>
      </div>
    </header>
    <main class="ui-container" id="content">
      <div class="event-large">Loading...</div>
    </main>

    <script>
      async function loadEvent(){
        const id = location.pathname.split('/').pop()
        const res = await fetch('/api/events/' + id)
        if (!res.ok){ document.getElementById('content').innerText = 'Evento no encontrado'; return }
        const e = await res.json()
        const thumb = e.image || `https://via.placeholder.com/1200x600?text=${encodeURIComponent(e.title)}`
        document.getElementById('content').innerHTML = `
          <article class="event-large">
            <div class="event-hero" style="background-image:url('${thumb}')"></div>
            <div style="margin-top:14px">
              <h1 style="margin:6px 0">${e.title}</h1>
              <p class="meta">${e.place} — ${e.date}</p>
              <p class="small-note">${e.summary}</p>
              <div style="margin-top:18px" class="card-actions">
                <button class="btn btn-primary">Recordarme</button>
                <button class="btn btn-test" onclick="testNotify('${e.id}')">Test Notif</button>
                <a class="btn btn-ghost" href="/api/logs/${e.monitor_key || e.id}/text?n=10" target="_blank" rel="noopener">Ver logs</a>
                <a href="/" class="btn btn-ghost">Volver</a>
              </div>
            </div>
          </article>
        `
      }
      loadEvent()

      async function testNotify(eventId){
        try{
          const res = await fetch('/api/notify', {method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({event_id: eventId})})
          const j = await res.json()
          alert('Test notification triggered for ' + j.url)
        }catch(err){
          alert('Failed to trigger test: ' + err)
        }
      }
    </script>
  </body>
</html>
